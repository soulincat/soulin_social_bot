name: Test Secrets Configuration

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test Secrets
        run: |
          echo "üîç Testing GitHub Secrets configuration..."
          echo ""
          
          # Check TELEGRAM_BOT_TOKEN
          if [ -z "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
            echo "‚ùå TELEGRAM_BOT_TOKEN is NOT set"
          else
            echo "‚úÖ TELEGRAM_BOT_TOKEN is set (length: ${#TELEGRAM_BOT_TOKEN} chars)"
          fi
          
          # Check CLIENTS_JSON
          if [ -z "${{ secrets.CLIENTS_JSON }}" ]; then
            echo "‚ùå CLIENTS_JSON is NOT set"
          else
            echo "‚úÖ CLIENTS_JSON is set (length: ${#CLIENTS_JSON} chars)"
            # Try to validate JSON
            echo '${{ secrets.CLIENTS_JSON }}' > /tmp/test_clients.json
            if python3 -m json.tool /tmp/test_clients.json > /dev/null 2>&1; then
              echo "‚úÖ CLIENTS_JSON is valid JSON"
            else
              echo "‚ö†Ô∏è CLIENTS_JSON might not be valid JSON (check format)"
            fi
          fi
          
          # Check optional secrets
          echo ""
          echo "Optional secrets:"
          if [ -z "${{ secrets.BEEHIIV_API_KEY }}" ]; then
            echo "‚ö™ BEEHIIV_API_KEY not set (optional)"
          else
            echo "‚úÖ BEEHIIV_API_KEY is set"
          fi
          
          if [ -z "${{ secrets.INSTAGRAM_ACCESS_TOKEN }}" ]; then
            echo "‚ö™ INSTAGRAM_ACCESS_TOKEN not set (optional)"
          else
            echo "‚úÖ INSTAGRAM_ACCESS_TOKEN is set"
          fi
          
          if [ -z "${{ secrets.VERCEL_TOKEN }}" ]; then
            echo "‚ö™ VERCEL_TOKEN not set (optional)"
          else
            echo "‚úÖ VERCEL_TOKEN is set"
          fi
          
          echo ""
          echo "üìã Summary:"
          if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ] && [ -n "${{ secrets.CLIENTS_JSON }}" ]; then
            echo "‚úÖ All required secrets are configured!"
            echo "‚úÖ You can now run the weekly report workflow"
          else
            echo "‚ùå Missing required secrets. Please add them in Settings ‚Üí Secrets"
            exit 1
          fi

