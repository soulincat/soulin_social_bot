<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Post - Social Funnel Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/web/styles/dashboard.css">
    <style>
        .content-section {
            margin-bottom: 2rem;
        }
        .content-preview {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            max-height: 400px;
            height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.6;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: block;
        }
        .content-preview::-webkit-scrollbar {
            width: 8px;
        }
        .content-preview::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        .content-preview::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        .content-preview::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .content-preview:hover {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .content-preview::after {
            content: 'Click to view full content';
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            font-size: 0.75rem;
            color: #a8b2d1;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .content-preview:hover::after {
            opacity: 1;
        }
        .check-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            margin: 0.25rem;
        }
        .check-pass {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        .check-fail {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }
        .platform-tabs-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 1rem;
            flex-wrap: wrap;
        }
        .platform-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex: 1;
        }
        .platform-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #a8b2d1;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .platform-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
        }
        .platform-tab.selected {
            background: rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.4);
            color: #c084fc;
        }
        .platform-tab.selected::after {
            content: '‚úì';
            position: absolute;
            top: -4px;
            right: -4px;
            background: rgba(168, 85, 247, 0.8);
            color: #ffffff;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        .generate-button-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .derivative-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .derivative-item:last-child {
            margin-bottom: 0;
        }
        .social-platform {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            background: rgba(168, 85, 247, 0.2);
            border: 1px solid rgba(168, 85, 247, 0.4);
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #c084fc;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .social-content {
            background: rgba(255, 255, 255, 0.03);
            padding: 1.25rem;
            border-radius: 8px;
            max-height: 400px;
            min-height: 150px;
            overflow-y: auto;
            overflow-x: hidden;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.7;
            color: #ffffff;
            word-wrap: break-word;
            overflow-wrap: break-word;
            margin-top: 0.75rem;
            display: block;
            box-sizing: border-box;
        }
        .social-content::-webkit-scrollbar {
            width: 10px;
        }
        .social-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 5px;
            margin: 4px;
        }
        .social-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            border: 2px solid rgba(255, 255, 255, 0.08);
        }
        .social-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* Firefox scrollbar */
        .social-content {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.08);
        }
        .social-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .social-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .btn-approve {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
        }
        .btn-approve:hover {
            background: rgba(34, 197, 94, 0.3);
        }
        .btn-regenerate {
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid rgba(56, 189, 248, 0.4);
            color: #38bdf8;
        }
        .btn-regenerate:hover {
            background: rgba(56, 189, 248, 0.3);
        }
        .word-count {
            color: #a8b2d1;
            font-size: 0.75rem;
        }
        #derivatives-list::-webkit-scrollbar {
            width: 8px;
        }
        #derivatives-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        #derivatives-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        #derivatives-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .btn-edit {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }
        .btn-edit:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .btn-copy {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }
        .btn-copy:hover {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }
        .social-content:hover {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .social-content::after {
            content: 'Click to view full';
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            font-size: 0.7rem;
            color: #a8b2d1;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            background: rgba(3, 7, 18, 0.8);
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .social-content:hover::after {
            opacity: 1;
        }
        .edit-textarea {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            font-family: inherit;
            font-size: 0.9rem;
            line-height: 1.7;
            resize: vertical;
            white-space: pre-wrap;
        }
        .edit-textarea:focus {
            outline: none;
            border-color: rgba(168, 85, 247, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }
        .edit-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .btn-save {
            padding: 0.5rem 1rem;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #22c55e;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
        }
        .btn-save:hover {
            background: rgba(34, 197, 94, 0.3);
        }
        .btn-cancel {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
        }
        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .edit-mode {
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 1rem;
        }
        /* Content Popup Modal - Glassmorphism Style */
        .content-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 2rem;
            overflow-y: auto;
        }
        .content-popup.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .content-popup-inner {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .content-popup-inner::-webkit-scrollbar {
            width: 8px;
        }
        .content-popup-inner::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        .content-popup-inner::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        .content-popup-inner::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .content-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .content-popup-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #ffffff;
            font-family: 'Space Grotesk', sans-serif;
        }
        .content-popup-close {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
            font-weight: 300;
        }
        .content-popup-close:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        .content-popup-body {
            color: #ffffff;
            font-size: 0.95rem;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Inter', sans-serif;
        }
        .content-popup-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <canvas id="noise-canvas"></canvas>
    <main>
        <header class="app-header">
            <div class="brand-mark">
                <div class="logo-glyph">
                    <img id="user-profile-pic" src="/web/assets/default-avatar.png" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid rgba(168, 85, 247, 0.3);" onerror="this.style.display='none'; this.parentElement.innerHTML='‚òæ';">
                </div>
                <div>
                    <p class="pill-badge" id="project-name">Loading...</p>
                    <h1 id="post-title">Loading...</h1>
                </div>
            </div>
            <div class="nav-actions">
                <a href="/workspace" class="ghost-button" style="background: rgba(168, 85, 247, 0.2); border-color: rgba(168, 85, 247, 0.4);">Workspace</a>
                <a href="/" class="ghost-button">Dashboard</a>
                <a href="/content" class="ghost-button">Posts</a>
                <a href="/product" class="ghost-button">Product</a>
                <a href="/settings" class="ghost-button">Settings</a>
                <a href="/content/create" class="glass-button">+ New Post</a>
                <button id="logout-btn" class="ghost-button" onclick="handleLogout()" style="display: none;">Logout</button>
            </div>
        </header>

        <div id="post-content" style="max-width: 900px; margin: 0 auto;">
            <!-- Post will be loaded here -->
        </div>
    </main>

    <script>
        const postId = window.location.pathname.split('/').pop();
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async function loadPost() {
            try {
                console.log('Loading post:', postId);
                const response = await fetch(`/api/content/posts/${postId}`);
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Failed to load post:', response.status, errorData);
                    throw new Error(`Failed to load post: ${response.status} ${response.statusText}. ${errorData.error || ''}`);
                }
                
                const post = await response.json();
                
                // Debug: log the post data
                console.log('Post data received:', post);
                console.log('Post has raw_idea:', !!post.raw_idea);
                console.log('Post has center_post:', !!post.center_post);
                console.log('Post status:', post.status);
                
                // Load client name for navigation
                if (post.client_id) {
                    loadClientName(post.client_id);
                }
                
                if (!post) {
                    throw new Error('Post data is null or undefined');
                }
                
                // Ensure raw_idea exists (should always be present)
                if (!post.raw_idea && !post.center_post) {
                    console.warn('Post missing both raw_idea and center_post:', post);
                    post.raw_idea = 'No idea provided';
                }
                
                document.getElementById('post-title').textContent = post.center_post?.title || post.raw_idea?.substring(0, 50) || 'Untitled';
                
                const contentEl = document.getElementById('post-content');
                const checks = post.center_post?.checks || {};
                
                contentEl.innerHTML = `
                    <section class="glass-card content-section">
                        <div class="section-header">
                            <div class="panel-title">Original Idea</div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-copy" onclick="copyContent('idea', \`${(post.raw_idea || 'No idea provided').replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`, event)">üìã Copy</button>
                                <button class="btn-edit" onclick="editIdea()">‚úèÔ∏è Edit</button>
                            </div>
                        </div>
                        <div id="idea-display" style="background: rgba(255, 255, 255, 0.05); padding: 1.25rem; border-radius: 12px; border-left: 3px solid rgba(168, 85, 247, 0.5); max-height: 400px; overflow-y: auto; cursor: pointer;" onclick="showContentPopup('Original Idea', \`${(post.raw_idea || 'No idea provided').replace(/`/g, '\\`').replace(/\$/g, '\\$').replace(/\n/g, '\\n')}\`)">
                            <p style="color: #ffffff; font-size: 1rem; line-height: 1.7; white-space: pre-wrap; margin: 0;">${post.raw_idea || 'No idea provided'}</p>
                        </div>
                    </section>
                    
                    <section class="glass-card content-section">
                        <div class="section-header">
                            <div class="panel-title">Newsletter (Center Post)</div>
                            ${post.center_post ? `
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn-copy" onclick="copyContent('newsletter', \`${(post.center_post.content || '').replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`, event)">üìã Copy</button>
                                    <button class="btn-edit" onclick="editNewsletter()">‚úèÔ∏è Edit</button>
                                </div>
                            ` : ''}
                        </div>
                        ${post.center_post ? `
                            <div id="newsletter-display">
                                <h2>${post.center_post.title}</h2>
                                <div class="content-preview" onclick="showContentPopup('${post.center_post.title.replace(/'/g, "\\'")}', \`${(post.center_post.content || '').replace(/`/g, '\\`').replace(/\$/g, '\\$').replace(/\n/g, '\\n')}\`)">${(post.center_post.content || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                                <div style="margin-top: 1rem;">
                                    <strong>Validation Checks:</strong><br>
                                    ${Object.entries(checks).map(([key, value]) => `
                                        <span class="check-badge ${value ? 'check-pass' : 'check-fail'}">
                                            ${key}: ${value ? '‚úì' : '‚úó'}
                                        </span>
                                    `).join('')}
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                                    <p style="color: #a8b2d1; margin: 0;">
                                        ${post.center_post.word_count} words
                                    </p>
                                    <button id="publish-newsletter-btn" class="glass-button" onclick="publishNewsletterFromPost()" style="display: none;">Publish to Beehiiv</button>
                                </div>
                            </div>
                        ` : `
                            <div style="background: rgba(248, 113, 113, 0.1); border: 1px solid rgba(248, 113, 113, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                                <p style="color: #f87171; margin: 0 0 0.5rem 0; font-weight: 500;">‚ö†Ô∏è Center post not created</p>
                                ${post.error ? `
                                    <p style="color: #a8b2d1; font-size: 0.9rem; margin: 0 0 0.5rem 0;">
                                        ${post.error.includes('ANTHROPIC_API_KEY') ? '‚ùå AI API key not configured. Please set ANTHROPIC_API_KEY in your .env file.' : 
                                          post.error.includes('401') || post.error.includes('authentication') ? '‚ùå Invalid API key. Please check your ANTHROPIC_API_KEY.' :
                                          post.error.includes('404') || post.error.includes('not_found') ? '‚ùå AI model not found. Please check your ANTHROPIC_MODEL setting.' :
                                          post.error.includes('JSON') || post.error.includes('parsing') ? '‚ùå AI returned invalid response format. This usually means the API response was malformed. Try again or check server logs.' :
                                          '‚ùå AI expansion failed: ' + post.error.substring(0, 200)}
                                    </p>
                                    ${post.error.includes('JSON') || post.error.includes('parsing') ? `
                                        <details style="margin-top: 0.5rem;">
                                            <summary style="color: #a8b2d1; font-size: 0.85rem; cursor: pointer;">Show error details</summary>
                                            <pre style="background: rgba(0, 0, 0, 0.3); padding: 0.75rem; border-radius: 8px; margin-top: 0.5rem; font-size: 0.8rem; color: #f87171; overflow-x: auto; max-height: 200px; overflow-y: auto;">${escapeHtml(post.error)}</pre>
                                        </details>
                                    ` : ''}
                                ` : ''}
                                <p style="color: #a8b2d1; font-size: 0.85rem; margin: 0;">Status: ${post.status || 'idea'}</p>
                            </div>
                            <div class="action-buttons">
                                <button class="glass-button" onclick="expandPost()">Expand with AI</button>
                            </div>
                        `}
                    </section>
                    
                    <section class="glass-card content-section">
                        <div class="panel-title">Socials</div>
                        <div class="platform-tabs-container">
                            <div class="platform-tabs" id="platform-tabs">
                                <button class="platform-tab" data-platform="linkedin" onclick="togglePlatform('linkedin')">LinkedIn</button>
                                <button class="platform-tab" data-platform="x" onclick="togglePlatform('x')">X</button>
                                <button class="platform-tab" data-platform="threads" onclick="togglePlatform('threads')">Threads</button>
                                <button class="platform-tab" data-platform="instagram" onclick="togglePlatform('instagram')">IG</button>
                                <button class="platform-tab" data-platform="substack" onclick="togglePlatform('substack')">Substack</button>
                                <button class="platform-tab" data-platform="telegram" onclick="togglePlatform('telegram')">Telegram</button>
                            </div>
                            <div class="generate-button-container">
                                <button class="glass-button" onclick="generateDerivatives()" id="generate-btn" style="display: none;">Generate Selected</button>
                                <span id="filter-hint" style="color: #a8b2d1; font-size: 0.85rem; display: none;">Click platforms to filter</span>
                            </div>
                        </div>
                        <div id="derivatives-list" style="max-height: 70vh; overflow-y: auto; padding-right: 0.5rem; margin-top: 1.5rem;">
                            <p style="color: #a8b2d1;">Loading socials...</p>
                        </div>
                    </section>
                `;
                
                // Load derivatives first, then update button
                loadDerivatives();
            } catch (error) {
                document.getElementById('post-content').innerHTML = `
                    <section class="glass-card">
                        <p style="color: #f87171;">Error loading post: ${error.message}</p>
                    </section>
                `;
            }
        }
        
        let allDerivatives = [];
        let selectedPlatforms = new Set(); // For generation selection
        let filteredPlatforms = new Set(); // For viewing filters
        
        function togglePlatform(platform) {
            const tab = document.querySelector(`[data-platform="${platform}"]`);
            
            // If no content generated yet, use as selection for generation
            if (allDerivatives.length === 0) {
                if (selectedPlatforms.has(platform)) {
                    selectedPlatforms.delete(platform);
                    tab.classList.remove('selected');
                } else {
                    selectedPlatforms.add(platform);
                    tab.classList.add('selected');
                }
                updateGenerateButton();
            } else {
                // If content exists, use as filter for viewing
                if (filteredPlatforms.has(platform)) {
                    filteredPlatforms.delete(platform);
                    tab.classList.remove('selected');
                } else {
                    filteredPlatforms.add(platform);
                    tab.classList.add('selected');
                }
                renderDerivatives();
            }
        }
        
        function updateGenerateButton() {
            const btn = document.getElementById('generate-btn');
            const hint = document.getElementById('filter-hint');
            if (!btn || !hint) return; // Elements not yet created
            
            // Show/hide based on whether content exists
            if (allDerivatives.length === 0) {
                // Generation mode: show generate button
                btn.style.display = 'inline-block';
                hint.style.display = 'none';
                if (selectedPlatforms.size === 0) {
                    btn.textContent = 'Generate All Socials';
                } else {
                    btn.textContent = `Generate ${selectedPlatforms.size} Selected`;
                }
            } else {
                // Filter mode: show hint, hide generate button
                btn.style.display = 'none';
                hint.style.display = 'inline-block';
                if (filteredPlatforms.size === 0) {
                    hint.textContent = 'Showing all platforms ‚Ä¢ Click to filter';
                } else {
                    hint.textContent = `Filtering ${filteredPlatforms.size} platform(s) ‚Ä¢ Click to change`;
                }
            }
        }
        
        function renderDerivatives() {
            const listEl = document.getElementById('derivatives-list');
            
            if (allDerivatives.length === 0) {
                listEl.innerHTML = '<p style="color: #a8b2d1;">No socials generated yet. Select platforms and click "Generate Selected" to create posts.</p>';
                return;
            }
            
            // Filter by selected platforms if any are selected
            // Also exclude newsletter type from socials section
            let filtered = allDerivatives.filter(deriv => deriv.type !== 'newsletter');
            if (filteredPlatforms.size > 0) {
                filtered = filtered.filter(deriv => {
                    const platform = deriv.type.toLowerCase();
                    return filteredPlatforms.has(platform);
                });
            }
            
            if (filtered.length === 0) {
                listEl.innerHTML = '<p style="color: #a8b2d1;">No socials match the selected platform filters.</p>';
                return;
            }
            
            const platformNames = {
                'linkedin': 'LinkedIn',
                'x': 'X',
                'social_x': 'X',
                'threads': 'Threads',
                'instagram': 'Instagram',
                'ig': 'Instagram',
                'social_ig': 'Instagram',
                'substack': 'Substack',
                'newsletter': 'Newsletter',
                'telegram': 'Telegram'
            };
            
            listEl.innerHTML = filtered.map(deriv => {
                const platformName = platformNames[deriv.type.toLowerCase()] || deriv.type.replace('social_', '').replace('_', ' ').toUpperCase();
                const status = deriv.metadata?.status || 'draft';
                const wordCount = deriv.content ? deriv.content.split(/\s+/).length : 0;
                const isDraft = status === 'draft';
                const isApproved = status === 'approved';
                const isQueued = status === 'queued';
                const isPublished = status === 'published';
                const isNewsletter = deriv.type === 'newsletter';
                
                // Format scheduled time if queued
                let scheduledTimeDisplay = '';
                if (status === 'queued' && deriv.scheduled_for) {
                    try {
                        const scheduledDate = new Date(deriv.scheduled_for);
                        scheduledTimeDisplay = `<br><span style="color: #38bdf8; font-size: 0.75rem;">Scheduled: ${scheduledDate.toLocaleString()}</span>`;
                    } catch (e) {
                        scheduledTimeDisplay = `<br><span style="color: #38bdf8; font-size: 0.75rem;">Scheduled: ${deriv.scheduled_for}</span>`;
                    }
                }
                
                // Format published info if published
                let publishedDisplay = '';
                if (isPublished) {
                    if (deriv.published_url) {
                        publishedDisplay = `<br><a href="${deriv.published_url}" target="_blank" style="color: #10b981; font-size: 0.75rem;">View on Beehiiv ‚Üí</a>`;
                    } else {
                        publishedDisplay = `<br><span style="color: #10b981; font-size: 0.75rem;">‚úì Published</span>`;
                    }
                }
                
                // Action buttons
                let actionButtons = '';
                const contentForPopup = (deriv.content || 'No content').replace(/`/g, '\\`').replace(/\$/g, '\\$').replace(/\n/g, '\\n').replace(/'/g, "\\'");
                
                // Newsletter derivatives are not shown in socials section
                // Skip rendering newsletter type here
                if (isNewsletter) {
                    return ''; // Don't render newsletter in socials section
                } else {
                    actionButtons = `
                        <button class="btn-copy" onclick="copyContent('social-${deriv.id}', \`${contentForPopup}\`)" title="Copy content">üìã</button>
                        <button class="btn-edit" onclick="editSocialPost('${deriv.id}')">‚úèÔ∏è Edit</button>
                    `;
                }
                
                return `
                    <div class="derivative-item" data-platform="${deriv.type.toLowerCase()}" style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <div class="social-platform">${platformName}</div>
                            <div style="display: flex; gap: 0.5rem;">
                                ${actionButtons}
                            </div>
                        </div>
                        <div class="social-meta">
                            <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <p style="color: #a8b2d1; margin: 0; font-size: 0.85rem;">
                                    Status: <span style="color: ${status === 'published' ? '#22c55e' : status === 'queued' ? '#38bdf8' : status === 'approved' ? '#a855f7' : '#a8b2d1'}">${status}</span>${scheduledTimeDisplay}${publishedDisplay}
                                </p>
                                <span class="word-count">${wordCount} words</span>
                            </div>
                            <div class="social-actions">
                                ${isDraft ? `<button class="btn-small btn-approve" onclick="approvePost('${deriv.id}')">Approve</button>` : ''}
                                <button class="btn-small btn-regenerate" onclick="regeneratePost('${deriv.id}')">Regenerate</button>
                            </div>
                        </div>
                        <div id="social-content-${deriv.id}" class="social-content" onclick="showContentPopup('${platformName} Post', \`${contentForPopup}\`)" style="max-height: 400px; min-height: 150px; overflow-y: auto; overflow-x: hidden; display: block; box-sizing: border-box;">${(deriv.content || 'No content').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                    </div>
                `;
            }).join('');
        }
        
        async function loadDerivatives() {
            try {
                const response = await fetch(`/api/content/derivatives?post_id=${postId}`);
                const data = await response.json();
                allDerivatives = data.derivatives || [];
                
                // Check for newsletter derivative and show/hide publish button
                const newsletterDeriv = allDerivatives.find(d => d.type === 'newsletter');
                const publishBtn = document.getElementById('publish-newsletter-btn');
                if (publishBtn) {
                    if (newsletterDeriv) {
                        const status = newsletterDeriv.metadata?.status || 'draft';
                        if (status === 'approved' || status === 'queued') {
                            publishBtn.style.display = 'block';
                            publishBtn.setAttribute('data-deriv-id', newsletterDeriv.id);
                        } else {
                            publishBtn.style.display = 'none';
                        }
                    } else {
                        publishBtn.style.display = 'none';
                    }
                }
                
                const listEl = document.getElementById('derivatives-list');
                // Filter out newsletter from socials
                const socialDerivatives = allDerivatives.filter(d => d.type !== 'newsletter');
                if (socialDerivatives.length === 0) {
                    listEl.innerHTML = '<p style="color: #a8b2d1;">No socials generated yet. Select platforms and click "Generate Selected" to create posts.</p>';
                    // Clear any selected platforms when no content exists
                    selectedPlatforms.clear();
                    filteredPlatforms.clear();
                    document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.remove('selected'));
                    updateGenerateButton();
                    return;
                }
                
                // Clear generation selection and switch to filter mode
                selectedPlatforms.clear();
                filteredPlatforms.clear();
                document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.remove('selected'));
                
                renderDerivatives();
                updateGenerateButton();
            } catch (error) {
                console.error('Error loading derivatives:', error);
            }
        }
        
        async function approvePost(derivId) {
            try {
                const response = await fetch(`/api/content/derivatives/${derivId}/approve`, {
                    method: 'POST'
                });
                if (response.ok) {
                    alert('Post approved! It can now be scheduled.');
                    loadDerivatives();
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to approve'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        async function regeneratePost(derivId) {
            if (!confirm('Regenerate this post? This will replace the current content.')) {
                return;
            }
            try {
                const response = await fetch(`/api/content/derivatives/${derivId}/regenerate`, {
                    method: 'POST'
                });
                if (response.ok) {
                    alert('Post regenerated! Refreshing...');
                    loadDerivatives();
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to regenerate'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        async function expandPost() {
            if (!confirm('Expand this post with AI? This will generate the center post content.')) {
                return;
            }
            
            const button = event?.target || document.querySelector('button[onclick="expandPost()"]');
            if (button) {
                button.disabled = true;
                button.textContent = 'Expanding...';
            }
            
            try {
                const response = await fetch(`/api/content/posts/${postId}/expand`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('access_token') || ''}`
                    },
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ Post expanded successfully! Refreshing...');
                    // Reload the post to show the new center_post
                    await loadPost();
                } else {
                    // Reload the post first to show the error in the UI
                    await loadPost();
                    // Then show alert
                    alert(`‚ùå Error: ${data.error || 'Failed to expand post'}\n\nCheck the error details below for more information.`);
                    if (button) {
                        button.disabled = false;
                        button.textContent = 'Expand with AI';
                    }
                }
            } catch (error) {
                console.error('Expand error:', error);
                alert(`‚ùå Error: ${error.message}`);
                if (button) {
                    button.disabled = false;
                    button.textContent = 'Expand with AI';
                }
            }
        }
        
        // Edit functions
        function editIdea() {
            const displayEl = document.getElementById('idea-display');
            const currentText = displayEl.querySelector('p').textContent;
            
            displayEl.innerHTML = `
                <textarea class="edit-textarea" id="idea-edit">${currentText}</textarea>
                <div class="edit-actions">
                    <button class="btn-save" onclick="saveIdea()">Save</button>
                    <button class="btn-cancel" onclick="cancelEditIdea('${currentText.replace(/'/g, "\\'")}')">Cancel</button>
                </div>
            `;
        }
        
        async function saveIdea() {
            const newText = document.getElementById('idea-edit').value;
            try {
                const response = await fetch(`/api/content/posts/${postId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ raw_idea: newText })
                });
                if (response.ok) {
                    const displayEl = document.getElementById('idea-display');
                    displayEl.innerHTML = `<p style="color: #ffffff; font-size: 1rem; line-height: 1.7; white-space: pre-wrap; margin: 0;">${newText || 'No idea provided'}</p>`;
                    alert('Idea updated successfully!');
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to update'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        function cancelEditIdea(originalText) {
            const displayEl = document.getElementById('idea-display');
            displayEl.innerHTML = `<p style="color: #ffffff; font-size: 1rem; line-height: 1.7; white-space: pre-wrap; margin: 0;">${originalText || 'No idea provided'}</p>`;
        }
        
        function editNewsletter() {
            const displayEl = document.getElementById('newsletter-display');
            const contentEl = displayEl.querySelector('.content-preview');
            const currentContent = contentEl.textContent;
            
            displayEl.innerHTML = `
                <textarea class="edit-textarea" id="newsletter-edit" style="min-height: 300px;">${currentContent}</textarea>
                <div class="edit-actions">
                    <button class="btn-save" onclick="saveNewsletter()">Save</button>
                    <button class="btn-cancel" onclick="cancelEditNewsletter('${currentContent.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')">Cancel</button>
                </div>
            `;
        }
        
        async function saveNewsletter() {
            const newContent = document.getElementById('newsletter-edit').value;
            try {
                // Get current post to preserve other center_post fields
                const postResponse = await fetch(`/api/content/posts/${postId}`);
                const post = await postResponse.json();
                
                const centerPost = post.center_post ? {...post.center_post} : {};
                centerPost.content = newContent;
                // Recalculate word count
                centerPost.word_count = newContent.split(/\s+/).length;
                
                const response = await fetch(`/api/content/posts/${postId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ center_post: centerPost })
                });
                if (response.ok) {
                    // Reload the page to show updated content
                    loadPost();
                    alert('Newsletter updated successfully!');
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to update'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        function cancelEditNewsletter(originalContent) {
            loadPost(); // Reload to restore original
        }
        
        function editSocialPost(derivId) {
            const contentEl = document.getElementById(`social-content-${derivId}`);
            const currentContent = contentEl.textContent;
            
            contentEl.innerHTML = `
                <textarea class="edit-textarea" id="social-edit-${derivId}" style="min-height: 200px;">${currentContent}</textarea>
                <div class="edit-actions">
                    <button class="btn-save" onclick="saveSocialPost('${derivId}')">Save</button>
                    <button class="btn-cancel" onclick="cancelEditSocialPost('${derivId}', '${currentContent.replace(/'/g, "\\'").replace(/\n/g, "\\n")}')">Cancel</button>
                </div>
            `;
        }
        
        async function saveSocialPost(derivId) {
            const newContent = document.getElementById(`social-edit-${derivId}`).value;
            try {
                const response = await fetch(`/api/content/derivatives/${derivId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ content: newContent })
                });
                if (response.ok) {
                    const contentEl = document.getElementById(`social-content-${derivId}`);
                    const escapedContent = (newContent || 'No content').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    const contentForPopup = (newContent || 'No content').replace(/`/g, '\\`').replace(/\$/g, '\\$').replace(/\n/g, '\\n').replace(/'/g, "\\'");
                    contentEl.innerHTML = escapedContent;
                    contentEl.setAttribute('onclick', `showContentPopup('Social Post', \`${contentForPopup}\`)`);
                    contentEl.style.maxHeight = '400px';
                    contentEl.style.minHeight = '150px';
                    contentEl.style.overflowY = 'auto';
                    contentEl.style.overflowX = 'hidden';
                    contentEl.style.display = 'block';
                    contentEl.style.boxSizing = 'border-box';
                    alert('Social post updated successfully!');
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error || 'Failed to update'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        function cancelEditSocialPost(derivId, originalContent) {
            const contentEl = document.getElementById(`social-content-${derivId}`);
            // Restore with click handler
            const contentForPopup = (originalContent || 'No content').replace(/`/g, '\\`').replace(/\$/g, '\\$').replace(/\n/g, '\\n').replace(/'/g, "\\'");
            const escapedContent = (originalContent || 'No content').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            contentEl.innerHTML = escapedContent;
            contentEl.setAttribute('onclick', `showContentPopup('Social Post', \`${contentForPopup}\`)`);
            contentEl.style.maxHeight = '400px';
            contentEl.style.minHeight = '150px';
            contentEl.style.overflowY = 'auto';
            contentEl.style.overflowX = 'hidden';
            contentEl.style.display = 'block';
            contentEl.style.boxSizing = 'border-box';
        }
        
        // Copy content to clipboard
        async function copyContent(type, content, event) {
            try {
                await navigator.clipboard.writeText(content);
                // Show feedback
                const button = (event || window.event)?.target?.closest('.btn-copy');
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úì Copied!';
                    button.style.color = '#22c55e';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.color = '';
                    }, 2000);
                }
            } catch (err) {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            }
        }
        
        // Show content popup
        function showContentPopup(title, content) {
            // Prevent popup when clicking inside edit mode
            if (event.target.closest('.edit-textarea') || event.target.closest('.edit-actions')) {
                return;
            }
            
            let popup = document.getElementById('content-popup');
            if (!popup) {
                // Create popup if it doesn't exist
                const popupHTML = `
                    <div id="content-popup" class="content-popup">
                        <div class="content-popup-inner">
                            <div class="content-popup-header">
                                <div class="content-popup-title">${title}</div>
                                <button class="content-popup-close" onclick="closeContentPopup()">√ó</button>
                            </div>
                            <div class="content-popup-body" id="popup-content-body"></div>
                            <div class="content-popup-actions">
                                <button class="btn-copy" onclick="copyPopupContent()">üìã Copy Content</button>
                                <button class="btn-cancel" onclick="closeContentPopup()">Close</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', popupHTML);
                popup = document.getElementById('content-popup');
            }
            
            const popupBody = document.getElementById('popup-content-body');
            popupBody.textContent = content;
            
            popup.classList.add('active');
            
            // Store content for copy function
            popup.dataset.content = content;
            
            // Close on escape key
            const escapeHandler = function(e) {
                if (e.key === 'Escape') {
                    closeContentPopup();
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
            
            // Close on background click
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closeContentPopup();
                }
            });
        }
        
        function closeContentPopup() {
            const popup = document.getElementById('content-popup');
            if (popup) {
                popup.classList.remove('active');
            }
        }
        
        function copyPopupContent() {
            const popup = document.getElementById('content-popup');
            if (popup && popup.dataset.content) {
                const content = popup.dataset.content;
                navigator.clipboard.writeText(content).then(() => {
                    const button = event.target;
                    const originalText = button.innerHTML;
                    button.innerHTML = '‚úì Copied!';
                    button.style.color = '#22c55e';
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.style.color = '';
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy to clipboard');
                });
            }
        }
        
        async function generateDerivatives() {
            const platforms = selectedPlatforms.size > 0 
                ? Array.from(selectedPlatforms) 
                : ['linkedin', 'x', 'threads', 'instagram', 'substack', 'telegram'];
            
            if (platforms.length === 0) {
                alert('Please select at least one platform');
                return;
            }
            
            try {
                const btn = document.getElementById('generate-btn');
                btn.disabled = true;
                btn.textContent = 'Generating...';
                
                const response = await fetch(`/api/content/posts/${postId}/generate`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        include_podcast: false,
                        platforms: platforms
                    })
                });
                
                if (response.ok) {
                    alert(`Socials generated for ${platforms.length} platform(s)! Refreshing...`);
                    // Clear generation selections (will switch to filter mode after reload)
                    selectedPlatforms.clear();
                    document.querySelectorAll('.platform-tab').forEach(tab => tab.classList.remove('selected'));
                    updateGenerateButton();
                    loadDerivatives(); // Reload derivatives to switch to filter mode
                } else {
                    const data = await response.json();
                    alert(`Error: ${data.error}`);
                    btn.disabled = false;
                    updateGenerateButton();
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
                const btn = document.getElementById('generate-btn');
                btn.disabled = false;
                updateGenerateButton();
            }
        }
        
        async function publishNewsletterFromPost() {
            const publishBtn = document.getElementById('publish-newsletter-btn');
            const derivId = publishBtn?.getAttribute('data-deriv-id');
            
            if (!derivId) {
                // Find newsletter derivative
                const response = await fetch(`/api/content/derivatives?post_id=${postId}`);
                const data = await response.json();
                const newsletterDeriv = data.derivatives?.find(d => d.type === 'newsletter');
                if (!newsletterDeriv) {
                    alert('Newsletter derivative not found. Please generate derivatives first.');
                    return;
                }
                await publishNewsletter(newsletterDeriv.id);
            } else {
                await publishNewsletter(derivId);
            }
        }
        
        async function publishNewsletter(derivId) {
            if (!confirm('Publish this newsletter to Beehiiv?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/content/derivatives/${derivId}/publish`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const data = await response.json();
                if (response.ok) {
                    alert(data.message || 'Newsletter published successfully!');
                    if (data.published_url) {
                        console.log('Published URL:', data.published_url);
                    }
                    // Reload derivatives to update status
                    await loadDerivatives();
                } else {
                    alert(`Error: ${data.error || 'Failed to publish'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        loadPost();
        
        // Noise canvas
        (function() {
            const canvas = document.getElementById('noise-canvas');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            function generateNoise() {
                const imageData = ctx.createImageData(canvas.width, canvas.height);
                const data = imageData.data;
                for (let i = 0; i < data.length; i += 4) {
                    const value = Math.random() * 255;
                    data[i] = value;
                    data[i + 1] = value;
                    data[i + 2] = value;
                    data[i + 3] = 15;
                }
                ctx.putImageData(imageData, 0, 0);
            }
            resizeCanvas();
            generateNoise();
            window.addEventListener('resize', () => {
                resizeCanvas();
                generateNoise();
            });
        })();

        // Authentication functions
        async function checkAuth() {
            try {
                const token = sessionStorage.getItem('access_token');
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch('/api/auth/me', {
                    headers: headers,
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const logoutBtn = document.getElementById('logout-btn');
                    if (logoutBtn) {
                        logoutBtn.style.display = 'block';
                    }
                    // Load user profile picture if available
                    loadUserProfilePicture(data.user);
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        async function handleLogout() {
            try {
                await fetch('/api/auth/logout', { 
                    method: 'POST',
                    credentials: 'include'
                });
                sessionStorage.removeItem('access_token');
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/login';
            }
        }
        
        // Load client name for navigation
        async function loadClientName(clientId) {
            if (!clientId) return;
            try {
                const token = sessionStorage.getItem('access_token');
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch('/api/clients', {
                    headers: headers,
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const client = data.clients?.find(c => c.client_id === clientId);
                    const projectNameEl = document.getElementById('project-name');
                    if (projectNameEl && client) {
                        projectNameEl.textContent = client.name || 'Project';
                    }
                }
            } catch (error) {
                console.error('Error loading client name:', error);
            }
        }
        
        // Load user profile picture
        async function loadUserProfilePicture(user) {
            if (!user) return;
            const profilePicEl = document.getElementById('user-profile-pic');
            if (!profilePicEl) return;
            
            // Try to get profile picture from user metadata or social links
            // For now, use default image. User can provide their own image later.
            // TODO: Fetch from social media profile if available
            const defaultPic = '/web/assets/default-avatar.png';
            profilePicEl.src = defaultPic;
        }

        checkAuth();
    </script>
</body>
</html>

